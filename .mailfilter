# Logfile
logfile "$HOME/mailfilter.log"

# Set maildir
MAILDIR="$HOME/Maildir"

# Check if we're called from a .qmail-EXT instead of .qmail
import EXT
if ( $EXT )
{
    # Does a vmailmgr user named $EXT exist?
    # If yes, deliver mail to his Maildir instead
    CHECKMAILDIR = `dumpvuser $EXT | grep '^Directory' | awk '{ print $2 }'`
    if ( $CHECKMAILDIR )
    {
        MAILDIR="$HOME/$CHECKMAILDIR"
    }
}

# Set directories
TRASHDIR = "$MAILDIR/.Trash"
SPAMDIR = "$MAILDIR/.Junk"

# Check folder structure
`test -d "$SPAMDIR" || maildirmake "$SPAMDIR"`

### Spam === high score from rspamd
if (/^X-Rspamd-Score: *([+-]?[0-9.]+)/:h && $MATCH1 >= 6)
{
  log "SPAM: Rspamd score=$MATCH1"
  to "$SPAMDIR"
  #to "$TRASHDIR"
}

# Deliver mail
to "$MAILDIR"
